<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="com.itwillbs.with_me.mapper.UserFundingMapper">

	<!-- 전체 게시물 수 조회(검색 기능 추가) -->
	<!-- 검색어에 따른 결과 게시물 수 조회 -> 페이징 때문 -->
	<select id="selectBoardListCount" resultType="int">
		SELECT count(*)
		FROM project_info
		WHERE 
		<choose>
			<when test="!searchKeyword.equals('')">
				project_category like concat('%',#{searchKeyword},'%') 	
				or project_category_detail like concat('%',#{searchKeyword},'%') 	
				or project_title like concat('%',#{searchKeyword},'%') 	
				or project_summary like concat('%',#{searchKeyword},'%') 	
				or project_category_detail like concat('%',#{searchKeyword},'%') 	
			</when>
			<otherwise>
				project_category = #{category}
				AND project_status = '승인'
			</otherwise>
		</choose>
	</select>

	<!-- 프로젝트 목록 표출 -->
	<select id="selectProjectList" resultType="hashmap">
		SELECT * 
		FROM project_info p JOIN creator_info c
		ON p.creator_idx = c.creator_idx 
		WHERE 
		<choose>
			<when test="!searchKeyword.equals('')">
				p.project_category like concat('%',#{searchKeyword},'%') 	
				or p.project_category_detail like concat('%',#{searchKeyword},'%') 	
				or p.project_title like concat('%',#{searchKeyword},'%') 	
				or p.project_summary like concat('%',#{searchKeyword},'%') 	
				or p.project_category_detail like concat('%',#{searchKeyword},'%') 	
			</when>
			<otherwise>
				(p.project_category = #{category}
				OR p.project_category_detail = #{category})
				AND project_status = '승인'
			</otherwise>
		</choose>
		limit 
			#{startRow}             -- Mapper 내의 메서드에서 @Param("startRow")
			, #{listLimit}			-- Mapper 내의 메서드에서 @Param("listLimit")
	</select>
	
	<!-- 프로젝트 상세정보 가져오기 -->
	<select id="selectProject" resultType="hashmap">
		SELECT *
		FROM project_info p 
		JOIN creator_info c
		ON p.creator_idx = c.creator_idx 
		JOIN member m
		ON c.creator_email = m.mem_email
		WHERE project_code = #{project_code}
	</select>
	
	<!-- 팔로워 수 계산 -->
	<select id="countFollower" resultType="int">
		SELECT COUNT(*)
		FROM follow
		WHERE follow_mem_email = #{creator_email}
	</select>
</mapper>